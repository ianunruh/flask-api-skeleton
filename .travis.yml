language: python

services:
  - mysql

env:
  global:
    - BACKEND_CONFIG=ci/config.yml

cache:
  directories:
    - $HOME/.pip-cache

install:
  - pip install -r requirements.txt -r test-requirements.txt --cache-dir $HOME/.pip-cache

before_script:
  - mysql -e 'CREATE DATABASE backend_test;'
  - python manage.py db migrate

script:
  - flake8 --exit-zero backend
  - py.test -s --cov=backend tests

after_success:
  - bash <(curl -s https://codecov.io/bash)
